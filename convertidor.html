<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertidor Multi-formato Bidireccional con OCR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptx2js@0.0.5/pptx2js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #0891b2;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --dark: #0f172a;
            --light: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --bg-primary: #ffffff;
            --bg-secondary: #f1f5f9;
            --border-color: #e2e8f0;
            --focus-ring: #3b82f6;
            --high-contrast-bg: #000000;
            --high-contrast-text: #ffffff;
            --high-contrast-border: #ffffff;
        }

        /* Estilos base con mejor accesibilidad */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Modo alto contraste */
        body.high-contrast {
            background: var(--high-contrast-bg);
            color: var(--high-contrast-text);
        }

        body.high-contrast .glass-effect,
        body.high-contrast .bg-white,
        body.high-contrast .feature-card {
            background: var(--high-contrast-bg);
            border-color: var(--high-contrast-border);
            color: var(--high-contrast-text);
        }

        body.high-contrast .text-gray-800,
        body.high-contrast .text-gray-700,
        body.high-contrast .text-gray-600 {
            color: var(--high-contrast-text);
        }

        body.high-contrast .text-gray-500,
        body.high-contrast .text-gray-400 {
            color: #cccccc;
        }

        body.high-contrast .border-gray-300,
        body.high-contrast .border-gray-200 {
            border-color: var(--high-contrast-border);
        }

        body.high-contrast .bg-gray-100,
        body.high-contrast .bg-gray-50 {
            background: #333333;
        }

        body.high-contrast .bg-red-50,
        body.high-contrast .bg-blue-50,
        body.high-contrast .bg-green-50,
        body.high-contrast .bg-orange-50,
        body.high-contrast .bg-purple-50,
        body.high-contrast .bg-yellow-50 {
            background: #444444;
        }

        body.high-contrast .hover\:bg-gray-50:hover {
            background: #444444;
        }

        body.high-contrast .hover\:bg-blue-50:hover {
            background: #1e40af;
        }

        body.high-contrast .hover\:bg-gray-100:hover {
            background: #555555;
        }

        body.high-contrast .btn-primary {
            background: var(--high-contrast-text);
            color: var(--high-contrast-bg);
        }

        body.high-contrast .btn-primary:hover {
            background: #cccccc;
        }

        /* Mejoras de accesibilidad visual */
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border-radius: 1rem;
        }

        .drop-zone {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 3px dashed var(--border-color);
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            background-color: var(--bg-primary);
        }

        .drop-zone:focus {
            outline: none;
            border-color: var(--focus-ring);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
        }

        .drop-zone:hover,
        .drop-zone:focus-within {
            background-color: rgba(37, 99, 235, 0.05);
            border-color: var(--primary);
        }

        .drop-zone.dragover {
            background-color: rgba(37, 99, 235, 0.1);
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .drop-zone.dragover .drag-indicator {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .progress-bar {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            height: 0.75rem;
            background-color: var(--primary);
            border-radius: 9999px;
        }

        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
        }

        /* Estilos de tabla accesibles */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .editable-cell {
            background-color: #eff6ff;
            outline: 2px dashed var(--primary);
        }

        /* Botones accesibles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            font-size: 1rem;
            line-height: 1.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #1e40af 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #e2e8f0;
        }

        .btn-icon {
            padding: 0.5rem;
            border-radius: 9999px;
            background-color: transparent;
            color: var(--text-secondary);
        }

        .btn-icon:hover {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Tarjetas de características mejoradas */
        .feature-card {
            background-color: var(--bg-primary);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .feature-icon {
            width: 4rem;
            height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .feature-icon.brain {
            background-color: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }

        .feature-icon.globe {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .feature-icon.lock {
            background-color: rgba(5, 150, 105, 0.1);
            color: #059669;
        }

        .feature-icon.exchange {
            background-color: rgba(245, 158, 6, 0.1);
            color: #f59e0b;
        }

        /* Pestañas accesibles */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
            border-radius: 0.25rem;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Formularios accesibles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        /* Interruptor accesible */
        .switch {
            position: relative;
            display: inline-block;
            width: 3rem;
            height: 1.5rem;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 1.5rem;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 1.25rem;
            width: 1.25rem;
            left: 0.125rem;
            bottom: 0.125rem;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:focus + .slider {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        input:checked + .slider:before {
            transform: translateX(1.5rem);
        }

        /* Notificaciones accesibles */
        .notification {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            max-width: 24rem;
            background-color: var(--bg-primary);
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            display: flex;
            align-items: flex-start;
            transform: translateY(120%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 50;
            border: 1px solid var(--border-color);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-icon {
            flex-shrink: 0;
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
        }

        .notification-icon.success {
            background-color: rgba(5, 150, 105, 0.1);
            color: #059669;
        }

        .notification-icon.error {
            background-color: rgba(220, 38, 38, 0.1);
            color: #dc2626;
        }

        .notification-icon.warning {
            background-color: rgba(217, 119, 6, 0.1);
            color: #d97706;
        }

        .notification-icon.info {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .notification-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .notification-close {
            flex-shrink: 0;
            margin-left: 0.75rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .notification-close:hover {
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }

        /* Modal accesible */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--bg-primary);
            border-radius: 1rem;
            max-width: 32rem;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 1.25rem;
        }

        .modal-close:hover {
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* Paginación accesible */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            margin-top: 1rem;
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.375rem;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover {
            background-color: var(--bg-secondary);
        }

        .pagination-btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .pagination-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Badges de formato mejorados */
        .format-badge {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .format-badge:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .format-badge:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .format-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .format-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Selector de formato bidireccional */
        .format-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2rem 0;
        }

        .format-input,
        .format-output {
            flex: 1;
            max-width: 300px;
        }

        .format-arrow {
            margin: 0 2rem;
            font-size: 2rem;
            color: var(--primary);
        }

        .format-box {
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .format-box.active {
            border-color: var(--primary);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .format-box:hover {
            border-color: var(--primary);
        }

        .format-box h3 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .format-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .format-option {
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .format-option:hover {
            background-color: var(--bg-primary);
            border-color: var(--border-color);
        }

        .format-option.selected {
            background-color: var(--primary);
            color: white;
        }

        /* Barra de progreso accesible */
        .progress-container {
            background-color: var(--bg-secondary);
            border-radius: 9999px;
            height: 0.75rem;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 9999px;
            transition: width 0.5s ease;
        }

        /* Indicador de carga accesible */
        .loader {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mejoras de enfoque para navegación por teclado */
        *:focus-visible {
            outline: 2px solid var(--focus-ring);
            outline-offset: 2px;
        }

        /* Saltar al contenido principal */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: white;
            padding: 8px;
            z-index: 100;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Indicadores visuales mejorados */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-indicator.success {
            background-color: rgba(5, 150, 105, 0.1);
            color: #059669;
        }

        .status-indicator.error {
            background-color: rgba(220, 38, 38, 0.1);
            color: #dc2626;
        }

        .status-indicator.warning {
            background-color: rgba(217, 119, 6, 0.1);
            color: #d97706;
        }

        .status-indicator.info {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        /* Mejoras de texto */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        h1 {
            font-size: 2.5rem;
        }

        h2 {
            font-size: 2rem;
        }

        h3 {
            font-size: 1.5rem;
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        /* Mejoras de espaciado */
        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .section {
            margin-bottom: 3rem;
        }

        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }

        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }

        /* Mejoras de responsividad */
        @media (max-width: 768px) {
            .container {
                padding: 0 0.75rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .feature-card {
                padding: 1.5rem;
            }
            
            .modal-content {
                width: 95%;
                max-height: 95vh;
            }
            
            .notification {
                left: 1rem;
                right: 1rem;
                max-width: none;
            }
            
            .format-selector {
                flex-direction: column;
            }
            
            .format-arrow {
                transform: rotate(90deg);
                margin: 1rem 0;
            }
        }

        /* Animaciones sutiles */
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Iconos con mejor contraste */
        .icon {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            vertical-align: middle;
        }

        /* Mejoras de accesibilidad para lectores de pantalla */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Indicador de arrastre mejorado */
        .drag-indicator {
            display: inline-block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

    <div class="container py-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">
                <i class="fas fa-exchange-alt text-blue-500 mr-3" aria-hidden="true"></i>
                Convertidor Multi-formato Bidireccional con OCR
            </h1>
            <p class="text-xl max-w-3xl mx-auto">
                Convierte entre múltiples formatos de documentos en ambas direcciones con tecnología de reconocimiento óptico de caracteres
            </p>
        </header>

        <div class="flex justify-end mb-6">
            <button id="toggleHighContrast" class="btn-icon" aria-label="Activar modo alto contraste">
                <i class="fas fa-adjust" aria-hidden="true"></i>
                <span class="sr-only">Modo alto contraste</span>
            </button>
            <button id="increaseFontSize" class="btn-icon" aria-label="Aumentar tamaño de texto">
                <i class="fas fa-search-plus" aria-hidden="true"></i>
                <span class="sr-only">Aumentar texto</span>
            </button>
            <button id="decreaseFontSize" class="btn-icon" aria-label="Reducir tamaño de texto">
                <i class="fas fa-search-minus" aria-hidden="true"></i>
                <span class="sr-only">Reducir texto</span>
            </button>
        </div>

        <nav class="tabs" role="tablist" aria-label="Secciones principales">
            <button class="tab active" id="converter-tab-btn" role="tab" aria-selected="true" aria-controls="converter-tab" tabindex="0">
                <i class="fas fa-exchange-alt mr-2" aria-hidden="true"></i>
                <span>Convertidor</span>
            </button>
            <button class="tab" id="history-tab-btn" role="tab" aria-selected="false" aria-controls="history-tab" tabindex="-1">
                <i class="fas fa-history mr-2" aria-hidden="true"></i>
                <span>Historial</span>
            </button>
            <button class="tab" id="settings-tab-btn" role="tab" aria-selected="false" aria-controls="settings-tab" tabindex="-1">
                <i class="fas fa-cog mr-2" aria-hidden="true"></i>
                <span>Configuración</span>
            </button>
        </nav>

        <main id="main-content">
            <div id="converter-tab" role="tabpanel" aria-labelledby="converter-tab-btn" tabindex="0">
                <section class="glass-effect p-6 mb-8">
                    <h2 class="text-xl font-semibold mb-4 text-center">
                        <i class="fas fa-exchange-alt text-blue-500 mr-2" aria-hidden="true"></i>
                        Selecciona los formatos de conversión
                    </h2>
                    
                    <div class="format-selector">
                        <div class="format-input">
                            <div class="format-box active" id="inputFormatBox">
                                <h3>Formato de entrada</h3>
                                <div class="format-options">
                                    <div class="format-option selected" data-format="pdf" tabindex="0"><i class="fas fa-file-pdf text-red-500"></i> PDF</div>
                                    <div class="format-option" data-format="docx" tabindex="0"><i class="fas fa-file-word text-blue-500"></i> Word</div>
                                    <div class="format-option" data-format="xlsx" tabindex="0"><i class="fas fa-file-excel text-green-500"></i> Excel</div>
                                    <div class="format-option" data-format="pptx" tabindex="0"><i class="fas fa-file-powerpoint text-orange-500"></i> PowerPoint</div>
                                    <div class="format-option" data-format="txt" tabindex="0"><i class="fas fa-file-alt text-gray-500"></i> Texto</div>
                                    <div class="format-option" data-format="image" tabindex="0"><i class="fas fa-file-image text-purple-500"></i> Imágenes</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="format-arrow">
                            <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                        </div>
                        
                        <div class="format-output">
                            <div class="format-box" id="outputFormatBox">
                                <h3>Formato de salida</h3>
                                <div class="format-options">
                                    <div class="format-option" data-format="pdf" tabindex="0"><i class="fas fa-file-pdf text-red-500"></i> PDF</div>
                                    <div class="format-option selected" data-format="docx" tabindex="0"><i class="fas fa-file-word text-blue-500"></i> Word</div>
                                    <div class="format-option" data-format="xlsx" tabindex="0"><i class="fas fa-file-excel text-green-500"></i> Excel</div>
                                    <div class="format-option" data-format="pptx" tabindex="0"><i class="fas fa-file-powerpoint text-orange-500"></i> PowerPoint</div>
                                    <div class="format-option" data-format="txt" tabindex="0"><i class="fas fa-file-alt text-gray-500"></i> Texto</div>
                                    <div class="format-option" data-format="html" tabindex="0"><i class="fas fa-file-code text-teal-500"></i> HTML</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="glass-effect p-6 mb-8">
                    <h2 class="text-xl font-semibold mb-4">
                        <i class="fas fa-cog text-blue-500 mr-2" aria-hidden="true"></i>
                        Configuración de conversión
                    </h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="form-group">
                            <label class="form-label">Opciones avanzadas</label>
                            <div class="flex flex-wrap gap-3">
                                <div class="flex items-center space-x-2">
                                    <label class="switch">
                                        <input type="checkbox" id="ocrToggle" aria-describedby="ocr-help">
                                        <span class="slider"></span>
                                    </label>
                                    <label for="ocrToggle" class="text-sm font-medium cursor-pointer">Usar OCR</label>
                                </div>
                                <button id="languageSelect" class="btn btn-secondary" aria-describedby="language-help">
                                    <i class="fas fa-language mr-2" aria-hidden="true"></i>
                                    <span>Español</span>
                                </button>
                                <button id="advancedOptions" class="btn btn-secondary" aria-describedby="advanced-help">
                                    <i class="fas fa-sliders-h mr-2" aria-hidden="true"></i>
                                    <span>Avanzado</span>
                                </button>
                            </div>
                            <p id="ocr-help" class="text-sm text-gray-500 mt-1">Activa el OCR para imágenes y documentos escaneados.</p>
                            <p id="language-help" class="sr-only">Selecciona el idioma para el reconocimiento de texto.</p>
                            <p id="advanced-help" class="sr-only">Accede a opciones avanzadas de conversión.</p>
                        </div>
                        <div class="form-group">
                            <label for="quality" class="form-label">Calidad de conversión</label>
                            <div class="flex items-center space-x-4">
                                <div class="flex-1">
                                    <input type="range" id="quality" min="1" max="3" value="2" class="w-full" aria-describedby="quality-help">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>Rápido</span>
                                        <span>Balanceado</span>
                                        <span>Alta calidad</span>
                                    </div>
                                </div>
                            </div>
                            <p id="quality-help" class="text-sm text-gray-500 mt-1">Balance entre velocidad y calidad del resultado.</p>
                        </div>
                    </div>
                </section>

                <section class="glass-effect p-8">
                    <div id="uploadSection" class="mb-8">
                        <div id="dropZone" class="drop-zone" tabindex="0" role="button" aria-label="Área de carga de archivos">
                            <div class="drag-indicator">
                                <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4" aria-hidden="true"></i>
                            </div>
                            <h3 class="text-2xl font-semibold mb-2" id="dropZoneTitle">Convierte PDF a Word</h3>
                            <p class="mb-4">Arrastra tus archivos aquí</p>
                            <p class="mb-4">o</p>
                            <button class="btn btn-primary" id="selectFilesBtn" aria-describedby="file-help">
                                <i class="fas fa-folder-open mr-2" aria-hidden="true"></i>
                                Seleccionar archivos
                            </button>
                            <input type="file" id="fileInput" multiple class="sr-only" aria-hidden="true">
                            <p id="file-help" class="text-sm text-gray-500 mt-4">Múltiples archivos permitidos (máx. 50MB por archivo)</p>
                        </div>
                    </div>

                    <div id="progressSection" class="hidden mb-8 fade-in" aria-live="polite">
                        <div class="bg-gray-100 p-6 rounded-lg">
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="text-lg font-semibold">Procesando archivos...</h3>
                                <button id="cancelProcess" class="btn-icon" aria-label="Cancelar proceso">
                                    <i class="fas fa-times-circle" aria-hidden="true"></i>
                                    <span class="sr-only">Cancelar</span>
                                </button>
                            </div>
                            <div class="progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-labelledby="progress-text">
                                <div id="progressBar" class="progress-bar" style="width: 0%"></div>
                            </div>
                            <p id="progressText" class="text-sm mt-2">Iniciando proceso...</p>
                            <div id="fileProgress" class="mt-4 space-y-2" aria-live="polite">
                                </div>
                        </div>
                    </div>

                    <div id="previewSection" class="hidden mb-8 fade-in">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">
                                <i class="fas fa-table text-green-500 mr-2" aria-hidden="true"></i>
                                Vista previa de datos extraídos
                            </h2>
                            <div class="flex space-x-2">
                                <button id="editDataBtn" class="btn btn-secondary" aria-describedby="edit-help">
                                    <i class="fas fa-edit mr-1" aria-hidden="true"></i>
                                    <span>Editar</span>
                                </button>
                                <button id="exportOptionsBtn" class="btn btn-secondary" aria-describedby="export-help">
                                    <i class="fas fa-file-export mr-1" aria-hidden="true"></i>
                                    <span>Opciones</span>
                                </button>
                            </div>
                            <p id="edit-help" class="sr-only">Habilitar la edición de datos en la tabla.</p>
                            <p id="export-help" class="sr-only">Acceder a opciones avanzadas de exportación.</p>
                        </div>
                        <div class="table-container">
                            <table id="previewTable" aria-label="Vista previa de datos extraídos">
                                <thead id="tableHeader">
                                    </thead>
                                <tbody id="tableBody">
                                    </tbody>
                            </table>
                        </div>
                        <div class="mt-4 flex flex-wrap items-center justify-between gap-4">
                            <div class="flex items-center space-x-4">
                                <p class="text-sm">
                                    <i class="fas fa-info-circle mr-1" aria-hidden="true"></i>
                                    <span id="rowCount">0</span> filas extraídas
                                </p>
                                <div class="flex items-center space-x-2">
                                    <label for="pageSize" class="text-sm">Filas por página:</label>
                                    <select id="pageSize" class="form-select w-auto" aria-label="Seleccionar número de filas por página">
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button id="downloadBtn" class="btn btn-primary" aria-describedby="download-help">
                                    <i class="fas fa-download mr-2" aria-hidden="true"></i>
                                    <span>Descargar</span>
                                </button>
                                <button id="shareBtn" class="btn btn-secondary" aria-describedby="share-help">
                                    <i class="fas fa-share-alt mr-2" aria-hidden="true"></i>
                                    <span>Compartir</span>
                                </button>
                            </div>
                            <p id="download-help" class="sr-only">Descargar los datos convertidos.</p>
                            <p id="share-help" class="sr-only">Compartir los datos convertidos.</p>
                        </div>
                        <nav id="pagination" class="pagination" aria-label="Paginación de resultados">
                            </nav>
                    </div>

                    <div id="errorSection" class="hidden mb-8 fade-in" role="alert" aria-live="assertive">
                        <div class="bg-red-50 border border-red-200 p-6 rounded-lg">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-exclamation-circle text-red-500 text-2xl" aria-hidden="true"></i>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-lg font-semibold text-red-800">Error al procesar los archivos</h3>
                                    <p id="errorMessage" class="text-red-600 mt-1"></p>
                                    <div class="mt-3 text-sm text-red-700">
                                        <p><i class="fas fa-lightbulb mr-1" aria-hidden="true"></i> Sugerencias:</p>
                                        <ul class="list-disc pl-5 mt-1 space-y-1">
                                            <li>Verifica que el archivo no esté dañado.</li>
                                            <li>Intenta activar la opción OCR para imágenes o PDF escaneados.</li>
                                            <li>Asegúrate de que el archivo no exceda el tamaño máximo de 50MB.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 flex space-x-3">
                                <button id="retryBtn" class="btn btn-primary">
                                    <i class="fas fa-redo mr-2" aria-hidden="true"></i>
                                    <span>Intentar nuevamente</span>
                                </button>
                                <button id="contactSupportBtn" class="btn btn-secondary">
                                    <i class="fas fa-headset mr-2" aria-hidden="true"></i>
                                    <span>Contactar soporte</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="history-tab" class="hidden" role="tabpanel" aria-labelledby="history-tab-btn" tabindex="0">
                <section class="glass-effect p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">
                            <i class="fas fa-history text-blue-500 mr-2" aria-hidden="true"></i>
                            Historial de conversiones
                        </h2>
                        <button id="clearHistoryBtn" class="btn btn-secondary" aria-describedby="clear-history-help">
                            <i class="fas fa-trash-alt mr-1" aria-hidden="true"></i>
                            <span>Limpiar historial</span>
                        </button>
                        <p id="clear-history-help" class="sr-only">Eliminar todas las conversiones del historial.</p>
                    </div>
                    
                    <div id="historyList" class="space-y-4" aria-live="polite">
                        <div class="text-center py-12 text-gray-500">
                            <i class="fas fa-inbox text-5xl mb-4" aria-hidden="true"></i>
                            <p>No hay conversiones recientes</p>
                        </div>
                    </div>
                </section>
            </div>

            <div id="settings-tab" class="hidden" role="tabpanel" aria-labelledby="settings-tab-btn" tabindex="0">
                <section class="glass-effect p-8">
                    <h2 class="text-2xl font-bold mb-6">
                        <i class="fas fa-cog text-blue-500 mr-2" aria-hidden="true"></i>
                        Configuración
                    </h2>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Configuración de OCR</h3>
                            <div class="space-y-4">
                                <div class="form-group">
                                    <label for="defaultLanguage" class="form-label">Idioma predeterminado</label>
                                    <select id="defaultLanguage" class="form-select" aria-describedby="language-default-help">
                                        <option value="spa">Español</option>
                                        <option value="eng">Inglés</option>
                                        <option value="fra">Francés</option>
                                        <option value="deu">Alemán</option>
                                        <option value="ita">Italiano</option>
                                        <option value="por">Portugués</option>
                                        <option value="rus">Ruso</option>
                                        <option value="chi_sim">Chino Simplificado</option>
                                        <option value="jpn">Japonés</option>
                                        <option value="kor">Coreano</option>
                                    </select>
                                    <p id="language-default-help" class="text-sm text-gray-500 mt-1">Idioma utilizado por defecto para el reconocimiento de texto.</p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="ocrQuality" class="form-label">Calidad de OCR</label>
                                    <div class="flex items-center space-x-4">
                                        <div class="flex-1">
                                            <input type="range" id="ocrQuality" min="1" max="3" value="2" class="w-full">
                                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>Rápido</span>
                                                <span>Balanceado</span>
                                                <span>Alta calidad</span>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-500 mt-1">Balance entre velocidad y precisión del reconocimiento.</p>
                                </div>
                                
                                <div class="form-group">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label for="enhanceContrast" class="form-label">Mejorar contraste</label>
                                            <p class="text-sm text-gray-500">Mejora la precisión en imágenes de baja calidad.</p>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="enhanceContrast" checked aria-describedby="contrast-help">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <p id="contrast-help" class="sr-only">Mejorar el contraste de las imágenes antes del procesamiento OCR.</p>
                                </div>
                                
                                <div class="form-group">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label for="detectTables" class="form-label">Detección de tablas</label>
                                            <p class="text-sm text-gray-500">Reconoce automáticamente estructuras de tablas.</p>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="detectTables" checked aria-describedby="tables-help">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <p id="tables-help" class="sr-only">Detectar automáticamente estructuras de tablas en el texto.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Configuración general</h3>
                            <div class="space-y-4">
                                <div class="form-group">
                                    <label for="defaultInputFormat" class="form-label">Formato de entrada predeterminado</label>
                                    <select id="defaultInputFormat" class="form-select" aria-describedby="input-format-help">
                                        <option value="pdf">PDF</option>
                                        <option value="docx">Word</option>
                                        <option value="xlsx">Excel</option>
                                        <option value="pptx">PowerPoint</option>
                                        <option value="txt">Texto</option>
                                        <option value="image">Imágenes</option>
                                    </select>
                                    <p id="input-format-help" class="text-sm text-gray-500 mt-1">Formato seleccionado por defecto para archivos de entrada.</p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="defaultOutputFormat" class="form-label">Formato de salida predeterminado</label>
                                    <select id="defaultOutputFormat" class="form-select" aria-describedby="output-format-help">
                                        <option value="pdf">PDF</option>
                                        <option value="docx">Word</option>
                                        <option value="xlsx">Excel</option>
                                        <option value="pptx">PowerPoint</option>
                                        <option value="txt">Texto</option>
                                        <option value="html">HTML</option>
                                    </select>
                                    <p id="output-format-help" class="text-sm text-gray-500 mt-1">Formato seleccionado por defecto para archivos de salida.</p>
                                </div>
                                
                                <div class="form-group">
                                    <label for="maxFileSize" class="form-label">Tamaño máximo de archivo (MB)</label>
                                    <input type="number" id="maxFileSize" min="1" max="100" value="50" class="form-input" aria-describedby="size-help">
                                    <p id="size-help" class="text-sm text-gray-500 mt-1">Tamaño máximo permitido para cada archivo.</p>
                                </div>
                                
                                <div class="form-group">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label for="saveHistory" class="form-label">Guardar historial</label>
                                            <p class="text-sm text-gray-500">Almacena tus conversiones recientes.</p>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="saveHistory" checked aria-describedby="history-help">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <p id="history-help" class="sr-only">Guardar un registro de las conversiones realizadas.</p>
                                </div>
                                
                                <div class="form-group">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label for="enableNotifications" class="form-label">Notificaciones</label>
                                            <p class="text-sm text-gray-500">Recibe alertas cuando termine el procesamiento.</p>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="enableNotifications" checked aria-describedby="notifications-help">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <p id="notifications-help" class="sr-only">Mostrar notificaciones cuando se completen las conversiones.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 flex justify-end">
                        <button id="saveSettingsBtn" class="btn btn-primary" aria-describedby="save-settings-help">
                            <i class="fas fa-save mr-2" aria-hidden="true"></i>
                            <span>Guardar configuración</span>
                        </button>
                        <p id="save-settings-help" class="sr-only">Guardar los cambios en la configuración.</p>
                    </div>
                </section>
            </div>
        </main>

        <section class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mt-12 mb-8">
            <article class="feature-card">
                <div class="feature-icon brain">
                    <i class="fas fa-brain" aria-hidden="true"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">OCR Avanzado</h3>
                <p>Reconocimiento de texto en imágenes y documentos escaneados con alta precisión.</p>
            </article>
            <article class="feature-card">
                <div class="feature-icon globe">
                    <i class="fas fa-globe" aria-hidden="true"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">Multi-idioma</h3>
                <p>Soporte para más de 10 idiomas con detección automática.</p>
            </article>
            <article class="feature-card">
                <div class="feature-icon exchange">
                    <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">Bidireccional</h3>
                <p>Convierte entre múltiples formatos en ambas direcciones sin limitaciones.</p>
            </article>
            <article class="feature-card">
                <div class="feature-icon lock">
                    <i class="fas fa-lock" aria-hidden="true"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">100% Seguro</h3>
                <p>Procesamiento local en tu navegador sin subir archivos a servidores externos.</p>
            </article>
        </section>
    </div>

    <div id="advancedOptionsModal" class="modal" role="dialog" aria-labelledby="advanced-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="advanced-modal-title" class="modal-title">Opciones avanzadas</h3>
                <button class="modal-close" aria-label="Cerrar opciones avanzadas">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <div class="form-group">
                        <label for="extractionMethod" class="form-label">Método de extracción</label>
                        <select id="extractionMethod" class="form-select" aria-describedby="extraction-help">
                            <option value="auto">Automático (recomendado)</option>
                            <option value="structure">Estructura de documento</option>
                            <option value="text">Solo texto</option>
                            <option value="table">Solo tablas</option>
                        </select>
                        <p id="extraction-help" class="text-sm text-gray-500 mt-1">Método utilizado para extraer datos de los documentos.</p>
                    </div>
                    
                    <div class="form-group">
                        <div class="flex items-center justify-between">
                            <div>
                                <label for="preserveFormatting" class="form-label">Preservar formato</label>
                                <p class="text-sm text-gray-500">Mantener estilos y formato original.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="preserveFormatting" checked aria-describedby="formatting-help">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p id="formatting-help" class="sr-only">Conservar el formato original del documento.</p>
                    </div>
                    
                    <div class="form-group">
                        <div class="flex items-center justify-between">
                            <div>
                                <label for="combineFiles" class="form-label">Combinar archivos</label>
                                <p class="text-sm text-gray-500">Unir todos los archivos en uno solo.</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="combineFiles" aria-describedby="combine-help">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p id="combine-help" class="sr-only">Combinar múltiples archivos en un único resultado.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="pageRange" class="form-label">Páginas a procesar (PDF)</label>
                        <input type="text" id="pageRange" placeholder="Ej: 1-5, 8, 11-13" class="form-input" aria-describedby="page-range-help">
                        <p id="page-range-help" class="text-sm text-gray-500 mt-1">Especifica qué páginas procesar para archivos PDF.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelAdvancedOptions" class="btn btn-secondary">Cancelar</button>
                <button id="applyAdvancedOptions" class="btn btn-primary">Aplicar</button>
            </div>
        </div>
    </div>

    <div id="exportOptionsModal" class="modal" role="dialog" aria-labelledby="export-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="export-modal-title" class="modal-title">Opciones de exportación</h3>
                <button class="modal-close" aria-label="Cerrar opciones de exportación">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <div class="form-group">
                        <label for="exportFileName" class="form-label">Nombre de archivo</label>
                        <input type="text" id="exportFileName" placeholder="convertido" class="form-input" aria-describedby="filename-help">
                        <p id="filename-help" class="text-sm text-gray-500 mt-1">Nombre para el archivo exportado.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="dateFormat" class="form-label">Formato de fecha</label>
                        <select id="dateFormat" class="form-select" aria-describedby="date-format-help">
                            <option value="ddmmyyyy">DD/MM/YYYY</option>
                            <option value="mmddyyyy">MM/DD/YYYY</option>
                            <option value="yyyymmdd">YYYY-MM-DD</option>
                            <option value="none">Sin fecha</option>
                        </select>
                        <p id="date-format-help" class="text-sm text-gray-500 mt-1">Formato de fecha para incluir en el nombre del archivo.</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Opciones adicionales</label>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <input type="checkbox" id="includeMetadata" class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" aria-describedby="metadata-help">
                                <label for="includeMetadata">Incluir metadatos</label>
                            </div>
                        </div>
                        <p id="metadata-help" class="sr-only">Incluir información sobre la conversión en el archivo exportado.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelExportOptions" class="btn btn-secondary">Cancelar</button>
                <button id="applyExportOptions" class="btn btn-primary">Exportar</button>
            </div>
        </div>
    </div>

    <div id="shareModal" class="modal" role="dialog" aria-labelledby="share-modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="share-modal-title" class="modal-title">Compartir archivo</h3>
                <button class="modal-close" aria-label="Cerrar compartir archivo">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <div class="form-group">
                        <label class="form-label">Método para compartir</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button class="share-method p-3 border rounded-lg text-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-pressed="false">
                                <i class="fas fa-envelope text-blue-500 text-xl mb-1" aria-hidden="true"></i>
                                <p>Email</p>
                            </button>
                            <button class="share-method p-3 border rounded-lg text-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-pressed="false">
                                <i class="fas fa-link text-green-500 text-xl mb-1" aria-hidden="true"></i>
                                <p>Generar enlace</p>
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Funcionalidad de compartir en desarrollo.</p>
                    </div>
                    
                    <div id="shareEmailForm" class="hidden space-y-3">
                        <div class="form-group">
                            <label for="recipientEmail" class="form-label">Email del destinatario</label>
                            <input type="email" id="recipientEmail" placeholder="ejemplo@dominio.com" class="form-input" aria-describedby="email-help">
                            <p id="email-help" class="text-sm text-gray-500 mt-1">Dirección de correo electrónico del destinatario.</p>
                        </div>
                        <div class="form-group">
                            <label for="emailMessage" class="form-label">Mensaje (opcional)</label>
                            <textarea id="emailMessage" rows="3" placeholder="Añade un mensaje para el destinatario" class="form-input" aria-describedby="message-help"></textarea>
                            <p id="message-help" class="text-sm text-gray-500 mt-1">Mensaje personalizado para incluir en el email.</p>
                        </div>
                    </div>
                    
                    <div id="shareLinkForm" class="hidden">
                        <div class="bg-gray-100 p-3 rounded-lg flex items-center">
                            <input type="text" id="generatedLink" readonly class="flex-1 bg-transparent border-none focus:outline-none text-sm" aria-label="Enlace generado">
                            <button id="copyLinkBtn" class="ml-2 text-blue-500 hover:text-blue-700" aria-label="Copiar enlace">
                                <i class="fas fa-copy" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="mt-2 flex items-center">
                            <input type="checkbox" id="setExpiry" class="mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" aria-describedby="expiry-help">
                            <label for="setExpiry">Establecer fecha de caducidad</label>
                        </div>
                        <div id="expiryDate" class="hidden mt-2">
                            <input type="date" id="linkExpiryDate" class="form-input" aria-describedby="expiry-date-help">
                            <p id="expiry-date-help" class="text-sm text-gray-500 mt-1">Fecha en la que el enlace dejará de funcionar.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelShare" class="btn btn-secondary">Cancelar</button>
                <button id="confirmShare" class="btn btn-primary">Compartir</button>
            </div>
        </div>
    </div>

    <div id="notificationToast" class="notification" role="alert" aria-live="assertive">
        <div class="notification-icon">
            <i class="fas fa-info-circle" aria-hidden="true"></i>
        </div>
        <div class="notification-content">
            <h4 class="notification-title"></h4>
            <p class="notification-message"></p>
        </div>
        <button class="notification-close" aria-label="Cerrar notificación">
            <i class="fas fa-times" aria-hidden="true"></i>
        </button>
    </div>

    <script>
        // Configurar PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
        
        // Variables globales
        let extractedData = [];
        let currentFileName = '';
        let useOCR = false;
        let ocrLanguage = 'spa';
        let filesToProcess = [];
        let currentFileIndex = 0;
        let isProcessing = false;
        let conversionHistory = JSON.parse(localStorage.getItem('conversionHistory')) || [];
        let settings = JSON.parse(localStorage.getItem('appSettings')) || {
            defaultLanguage: 'spa',
            ocrQuality: 2,
            enhanceContrast: true,
            detectTables: true,
            defaultInputFormat: 'pdf',
            defaultOutputFormat: 'docx',
            maxFileSize: 50,
            saveHistory: true,
            enableNotifications: true
        };
        let currentPage = 1;
        let rowsPerPage = 25;
        let isEditMode = false;
        let fontSize = 16;
        let inputFormat = 'pdf';
        let outputFormat = 'docx';
        
        // Elementos del DOM
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const selectFilesBtn = document.getElementById('selectFilesBtn');
        const uploadSection = document.getElementById('uploadSection');
        const progressSection = document.getElementById('progressSection');
        const previewSection = document.getElementById('previewSection');
        const errorSection = document.getElementById('errorSection');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const fileProgress = document.getElementById('fileProgress');
        const previewTable = document.getElementById('previewTable');
        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');
        const rowCount = document.getElementById('rowCount');
        const downloadBtn = document.getElementById('downloadBtn');
        const retryBtn = document.getElementById('retryBtn');
        const errorMessage = document.getElementById('errorMessage');
        const ocrToggle = document.getElementById('ocrToggle');
        const languageSelect = document.getElementById('languageSelect');
        const cancelProcess = document.getElementById('cancelProcess');
        const editDataBtn = document.getElementById('editDataBtn');
        const exportOptionsBtn = document.getElementById('exportOptionsBtn');
        const shareBtn = document.getElementById('shareBtn');
        const pageSize = document.getElementById('pageSize');
        const pagination = document.getElementById('pagination');
        const advancedOptions = document.getElementById('advancedOptions');
        const advancedOptionsModal = document.getElementById('advancedOptionsModal');
        const closeAdvancedModal = document.querySelector('#advancedOptionsModal .modal-close');
        const cancelAdvancedOptions = document.getElementById('cancelAdvancedOptions');
        const applyAdvancedOptions = document.getElementById('applyAdvancedOptions');
        const exportOptionsModal = document.getElementById('exportOptionsModal');
        const closeExportModal = document.querySelector('#exportOptionsModal .modal-close');
        const cancelExportOptions = document.getElementById('cancelExportOptions');
        const applyExportOptions = document.getElementById('applyExportOptions');
        const shareModal = document.getElementById('shareModal');
        const closeShareModal = document.querySelector('#shareModal .modal-close');
        const cancelShare = document.getElementById('cancelShare');
        const confirmShare = document.getElementById('confirmShare');
        const notificationToast = document.getElementById('notificationToast');
        const notificationIcon = document.querySelector('.notification-icon');
        const notificationTitle = document.querySelector('.notification-title');
        const notificationMessage = document.querySelector('.notification-message');
        const closeNotification = document.querySelector('.notification-close');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const historyList = document.getElementById('historyList');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const contactSupportBtn = document.getElementById('contactSupportBtn');
        const toggleHighContrast = document.getElementById('toggleHighContrast');
        const increaseFontSize = document.getElementById('increaseFontSize');
        const decreaseFontSize = document.getElementById('decreaseFontSize');
        const inputFormatBox = document.getElementById('inputFormatBox');
        const outputFormatBox = document.getElementById('outputFormatBox');
        const quality = document.getElementById('quality');
        const dropZoneTitle = document.getElementById('dropZoneTitle');
        
        // Pestañas
        const converterTabBtn = document.getElementById('converter-tab-btn');
        const historyTabBtn = document.getElementById('history-tab-btn');
        const settingsTabBtn = document.getElementById('settings-tab-btn');
        const converterTab = document.getElementById('converter-tab');
        const historyTab = document.getElementById('history-tab');
        const settingsTab = document.getElementById('settings-tab');
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar configuración guardada
            document.getElementById('defaultLanguage').value = settings.defaultLanguage;
            document.getElementById('ocrQuality').value = settings.ocrQuality;
            document.getElementById('enhanceContrast').checked = settings.enhanceContrast;
            document.getElementById('detectTables').checked = settings.detectTables;
            document.getElementById('defaultInputFormat').value = settings.defaultInputFormat;
            document.getElementById('defaultOutputFormat').value = settings.defaultOutputFormat;
            document.getElementById('maxFileSize').value = settings.maxFileSize;
            document.getElementById('saveHistory').checked = settings.saveHistory;
            document.getElementById('enableNotifications').checked = settings.enableNotifications;
            
            // Establecer formatos iniciales
            inputFormat = settings.defaultInputFormat;
            outputFormat = settings.defaultOutputFormat;
            updateFormatSelection();
            
            // Cargar historial
            renderHistory();
            
            // Eventos de pestañas
            converterTabBtn.addEventListener('click', () => switchTab('converter'));
            historyTabBtn.addEventListener('click', () => switchTab('history'));
            settingsTabBtn.addEventListener('click', () => switchTab('settings'));
            
            // Navegación por teclado para pestañas
            [converterTabBtn, historyTabBtn, settingsTabBtn].forEach((btn, index, array) => {
                btn.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowRight') {
                        const nextIndex = (index + 1) % array.length;
                        array[nextIndex].focus();
                    } else if (e.key === 'ArrowLeft') {
                        const prevIndex = (index - 1 + array.length) % array.length;
                        array[prevIndex].focus();
                    } else if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        btn.click();
                    }
                });
            });
            
            // Eventos de selección de formato
            document.querySelectorAll('#inputFormatBox .format-option').forEach(option => {
                const select = () => {
                    document.querySelectorAll('#inputFormatBox .format-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    inputFormat = option.getAttribute('data-format');
                    updateFileInputAccept();
                    updateFormatDescription();
                };
                option.addEventListener('click', select);
                option.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        select();
                    }
                });
            });
            
            document.querySelectorAll('#outputFormatBox .format-option').forEach(option => {
                const select = () => {
                    document.querySelectorAll('#outputFormatBox .format-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    outputFormat = option.getAttribute('data-format');
                    updateFormatDescription();
                };
                option.addEventListener('click', select);
                option.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        select();
                    }
                });
            });
            
            // Eventos de modales
            advancedOptions.addEventListener('click', () => openModal(advancedOptionsModal));
            closeAdvancedModal.addEventListener('click', () => closeModal(advancedOptionsModal));
            cancelAdvancedOptions.addEventListener('click', () => closeModal(advancedOptionsModal));
            applyAdvancedOptions.addEventListener('click', () => {
                closeModal(advancedOptionsModal);
                showNotification('Opciones aplicadas', 'Las opciones avanzadas se han aplicado correctamente', 'success');
            });
            
            exportOptionsBtn.addEventListener('click', () => openModal(exportOptionsModal));
            downloadBtn.addEventListener('click', () => openModal(exportOptionsModal));
            closeExportModal.addEventListener('click', () => closeModal(exportOptionsModal));
            cancelExportOptions.addEventListener('click', () => closeModal(exportOptionsModal));
            applyExportOptions.addEventListener('click', () => {
                closeModal(exportOptionsModal);
                downloadFile();
            });
            
            shareBtn.addEventListener('click', () => openModal(shareModal));
            closeShareModal.addEventListener('click', () => closeModal(shareModal));
            cancelShare.addEventListener('click', () => closeModal(shareModal));
            confirmShare.addEventListener('click', () => {
                closeModal(shareModal);
                showNotification('Compartido', 'El archivo se ha compartido correctamente', 'success');
            });
            
            closeNotification.addEventListener('click', () => notificationToast.classList.remove('show'));
            
            // Eventos de opciones de compartir
            document.querySelectorAll('.share-method').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.share-method').forEach(b => {
                        b.classList.remove('border-blue-500', 'bg-blue-50');
                        b.setAttribute('aria-pressed', 'false');
                    });
                    btn.classList.add('border-blue-500', 'bg-blue-50');
                    btn.setAttribute('aria-pressed', 'true');
                    
                    document.getElementById('shareEmailForm').classList.add('hidden');
                    document.getElementById('shareLinkForm').classList.add('hidden');
                    
                    if (btn.textContent.includes('Email')) {
                        document.getElementById('shareEmailForm').classList.remove('hidden');
                    } else if (btn.textContent.includes('enlace')) {
                        document.getElementById('shareLinkForm').classList.remove('hidden');
                        document.getElementById('generatedLink').value = `https://example.com/share/${Math.random().toString(36).substring(2, 15)}`;
                    }
                });
            });
            
            document.getElementById('setExpiry').addEventListener('change', (e) => {
                document.getElementById('expiryDate').classList.toggle('hidden', !e.target.checked);
            });
            
            document.getElementById('copyLinkBtn').addEventListener('click', () => {
                const linkInput = document.getElementById('generatedLink');
                navigator.clipboard.writeText(linkInput.value).then(() => {
                    showNotification('Enlace copiado', 'El enlace se ha copiado al portapapeles', 'success');
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    showNotification('Error al copiar', 'No se pudo copiar el enlace.', 'error');
                });
            });
            
            // Eventos de historial
            clearHistoryBtn.addEventListener('click', () => {
                if (confirm('¿Estás seguro de que quieres eliminar todo el historial?')) {
                    conversionHistory = [];
                    localStorage.removeItem('conversionHistory');
                    renderHistory();
                    showNotification('Historial eliminado', 'El historial de conversiones ha sido eliminado', 'info');
                }
            });
            
            // Eventos de configuración
            saveSettingsBtn.addEventListener('click', () => {
                settings = {
                    defaultLanguage: document.getElementById('defaultLanguage').value,
                    ocrQuality: parseInt(document.getElementById('ocrQuality').value),
                    enhanceContrast: document.getElementById('enhanceContrast').checked,
                    detectTables: document.getElementById('detectTables').checked,
                    defaultInputFormat: document.getElementById('defaultInputFormat').value,
                    defaultOutputFormat: document.getElementById('defaultOutputFormat').value,
                    maxFileSize: parseInt(document.getElementById('maxFileSize').value),
                    saveHistory: document.getElementById('saveHistory').checked,
                    enableNotifications: document.getElementById('enableNotifications').checked
                };
                
                localStorage.setItem('appSettings', JSON.stringify(settings));
                ocrLanguage = settings.defaultLanguage;
                languageSelect.querySelector('span').textContent = getLanguageName(settings.defaultLanguage);
                
                showNotification('Configuración guardada', 'La configuración se ha guardado correctamente', 'success');
            });
            
            // Evento de contacto con soporte
            contactSupportBtn.addEventListener('click', () => {
                showNotification('Soporte técnico', 'Envía un email a soporte@convertidor.app con una descripción del problema.', 'info');
            });
            
            // Evento de paginación
            pageSize.addEventListener('change', () => {
                rowsPerPage = parseInt(pageSize.value);
                currentPage = 1;
                displayPreview();
            });
            
            // Evento de edición de datos
            editDataBtn.addEventListener('click', () => {
                isEditMode = !isEditMode;
                editDataBtn.classList.toggle('bg-blue-100', isEditMode);
                editDataBtn.querySelector('span').textContent = isEditMode ? 'Guardar' : 'Editar';

                if (!isEditMode) {
                    saveEditedData();
                }

                const cells = tableBody.querySelectorAll('td');
                cells.forEach(cell => {
                    cell.contentEditable = isEditMode;
                    cell.classList.toggle('editable-cell', isEditMode);
                });
                
                showNotification(
                    isEditMode ? 'Modo edición activado' : 'Modo edición desactivado', 
                    isEditMode ? 'Ahora puedes editar los datos en la tabla. Haz clic en "Guardar" para aplicar los cambios.' : 'Los cambios se han guardado.',
                    'info'
                );
            });
            
            // Eventos de accesibilidad
            toggleHighContrast.addEventListener('click', () => {
                document.body.classList.toggle('high-contrast');
                localStorage.setItem('highContrast', document.body.classList.contains('high-contrast'));
            });
            
            increaseFontSize.addEventListener('click', () => {
                fontSize = Math.min(fontSize + 1, 22);
                document.documentElement.style.fontSize = `${fontSize}px`;
                localStorage.setItem('fontSize', fontSize);
            });
            
            decreaseFontSize.addEventListener('click', () => {
                fontSize = Math.max(fontSize - 1, 14);
                document.documentElement.style.fontSize = `${fontSize}px`;
                localStorage.setItem('fontSize', fontSize);
            });
            
            // Cargar configuración de accesibilidad
            if (localStorage.getItem('highContrast') === 'true') {
                document.body.classList.add('high-contrast');
            }
            
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                fontSize = parseInt(savedFontSize, 10);
                document.documentElement.style.fontSize = `${fontSize}px`;
            }
            
            // Cerrar modales con Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.active');
                    if (activeModal) {
                        closeModal(activeModal);
                    }
                }
            });
            
            // Hacer foco atrapado en modales
            [advancedOptionsModal, exportOptionsModal, shareModal].forEach(modal => {
                modal.addEventListener('keydown', trapFocus);
            });
            
            updateFormatDescription();
        });
        
        // Funciones para manejar modales
        function openModal(modal) {
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            const firstFocusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (firstFocusable) firstFocusable.focus();
        }

        function closeModal(modal) {
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
        }
        
        // Función para atrapar el foco dentro de un modal
        function trapFocus(e) {
            const modal = e.currentTarget;
            if (!modal.classList.contains('active')) return;
            
            const focusableElements = Array.from(modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            ));
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            if (e.key === 'Tab') {
                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        }
        
        function updateFormatSelection() {
            document.querySelectorAll('#inputFormatBox .format-option').forEach(option => {
                option.classList.toggle('selected', option.getAttribute('data-format') === inputFormat);
            });
            
            document.querySelectorAll('#outputFormatBox .format-option').forEach(option => {
                option.classList.toggle('selected', option.getAttribute('data-format') === outputFormat);
            });
            
            updateFileInputAccept();
            updateFormatDescription();
        }
        
        function updateFileInputAccept() {
            const acceptMap = {
                'pdf': '.pdf',
                'docx': '.doc,.docx',
                'xlsx': '.xls,.xlsx',
                'pptx': '.ppt,.pptx',
                'txt': '.txt,.rtf',
                'image': 'image/*'
            };
            fileInput.setAttribute('accept', acceptMap[inputFormat] || '*/*');
        }
        
        function updateFormatDescription() {
            const formatNames = {
                'pdf': 'PDF', 'docx': 'Word', 'xlsx': 'Excel', 'pptx': 'PowerPoint',
                'txt': 'Texto', 'html': 'HTML', 'image': 'Imágenes'
            };
            const inputName = formatNames[inputFormat] || inputFormat.toUpperCase();
            const outputName = formatNames[outputFormat] || outputFormat.toUpperCase();
            if (dropZoneTitle) dropZoneTitle.textContent = `Convierte ${inputName} a ${outputName}`;
        }
        
        dropZone.addEventListener('click', () => fileInput.click());
        selectFilesBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        retryBtn.addEventListener('click', resetConverter);
        ocrToggle.addEventListener('change', () => { useOCR = ocrToggle.checked; });
        languageSelect.addEventListener('click', selectLanguage);
        cancelProcess.addEventListener('click', cancelProcessing);
        
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(Array.from(e.dataTransfer.files));
        });
        
        function handleFileSelect(e) { handleFiles(Array.from(e.target.files)); }
        
        function handleFiles(files) {
            filesToProcess = files;
            if (filesToProcess.length === 0) return;

            const maxSize = settings.maxFileSize * 1024 * 1024;
            const oversizedFiles = filesToProcess.filter(file => file.size > maxSize);
            if (oversizedFiles.length > 0) {
                showError(`Algunos archivos exceden el tamaño máximo de ${settings.maxFileSize}MB.`);
                return;
            }
            
            currentFileIndex = 0;
            extractedData = [];
            currentPage = 1;
            showProgress();
            isProcessing = true;
            
            const combineFiles = document.getElementById('combineFiles')?.checked;
            if (combineFiles) processFilesCombined();
            else processNextFile();
        }
        
        function showProgress() {
            uploadSection.classList.add('hidden');
            previewSection.classList.add('hidden');
            errorSection.classList.add('hidden');
            progressSection.classList.remove('hidden');
            fileProgress.innerHTML = '';
            progressBar.style.width = '0%';
            progressBar.setAttribute('aria-valuenow', '0');
        }
        
        function updateProgress(percent, text, fileName = '') {
            progressBar.style.width = percent + '%';
            progressBar.setAttribute('aria-valuenow', percent);
            progressText.textContent = text;
        }

        async function processFilesCombined() {
            try {
                const allData = [];
                for (let i = 0; i < filesToProcess.length; i++) {
                    if (!isProcessing) break;
                    const file = filesToProcess[i];
                    currentFileName = file.name;
                    updateProgress(((i + 1) / filesToProcess.length) * 100, `Procesando ${file.name}...`);
                    
                    const data = await processSingleFile(file);

                    if (data.length > 0) {
                        if (allData.length > 0) allData.push([]);
                        allData.push([`Archivo: ${file.name}`]);
                        allData.push(...data);
                    }
                }
                extractedData = allData;
                if (isProcessing) onProcessingFinished();
            } catch (error) {
                console.error('Error processing files:', error);
                showError(`Error: ${error.message}`);
                isProcessing = false;
            }
        }
        
        async function processNextFile() {
            if (currentFileIndex >= filesToProcess.length || !isProcessing) {
                if (isProcessing) onProcessingFinished();
                isProcessing = false;
                return;
            }
            
            const file = filesToProcess[currentFileIndex];
            currentFileName = file.name;
            updateProgress(((currentFileIndex + 1) / filesToProcess.length) * 100, `Procesando ${file.name}...`);
            
            try {
                const data = await processSingleFile(file);
                if (data.length > 0) extractedData.push(...data);
            } catch (error) {
                console.error('Error processing file:', error);
                showNotification(`Error en ${file.name}`, error.message, 'error');
            } finally {
                currentFileIndex++;
                setTimeout(processNextFile, 100);
            }
        }
        
        async function processSingleFile(file) {
            switch (inputFormat) {
                case 'pdf': return processPDF(file);
                case 'docx': return processWord(file);
                case 'xlsx': return processExcel(file);
                case 'pptx': return processPowerPoint(file);
                case 'txt': return processText(file);
                case 'image': return processImage(file);
                default: throw new Error('Formato de entrada no soportado');
            }
        }
        
        function onProcessingFinished() {
            updateProgress(100, '¡Proceso completado!');
            setTimeout(() => {
                progressSection.classList.add('hidden');
                if (extractedData.length > 0) {
                    displayPreview();
                    previewSection.classList.remove('hidden');
                    if (settings.saveHistory) saveToHistory(filesToProcess.map(f => f.name), outputFormat);
                    if (settings.enableNotifications) showNotification('Conversión completada', `Se han procesado ${filesToProcess.length} archivos.`, 'success');
                } else {
                    showError('No se pudo extraer datos de los archivos.');
                }
            }, 500);
        }

        function cancelProcessing() {
            isProcessing = false;
            showNotification('Proceso cancelado', 'El procesamiento de archivos ha sido cancelado.', 'info');
            resetConverter();
        }
        
        async function processPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            const data = [];
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                if (useOCR) {
                    const viewport = page.getViewport({ scale: 2 });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    await page.render({ canvasContext: context, viewport }).promise;
                    const result = await Tesseract.recognize(canvas, ocrLanguage);
                    data.push(...parseTextToTable(result.data.text));
                } else {
                    const textContent = await page.getTextContent();
                    const text = textContent.items.map(item => item.str).join(' ');
                    data.push(...parseTextToTable(text));
                }
            }
            return data;
        }

        async function processWord(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            return parseTextToTable(result.value);
        }

        async function processExcel(file) {
            const arrayBuffer = await file.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const data = [];
            workbook.SheetNames.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const sheetData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                if (data.length > 0) data.push([]);
                data.push([`Hoja: ${sheetName}`]);
                data.push(...sheetData);
            });
            return data;
        }
        
        async function processPowerPoint(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const pptx = new Pptx2js(e.target.result);
                    const data = [];
                    pptx.parse(slides => {
                        slides.forEach((slide, index) => {
                            data.push([`Diapositiva ${index + 1}`]);
                            slide.slides.forEach(item => {
                                if (item.text) data.push(...parseTextToTable(item.text));
                            });
                        });
                        resolve(data);
                    });
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        async function processText(file) {
            const text = await file.text();
            return parseTextToTable(text);
        }
        
        async function processImage(file) {
            const result = await Tesseract.recognize(file, ocrLanguage);
            return parseTextToTable(result.data.text);
        }

        function parseTextToTable(text) {
            return text.split('\n').filter(line => line.trim()).map(line => [line.trim()]);
        }
        
        function displayPreview() {
            if (extractedData.length === 0) return;
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            const totalRows = extractedData.length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = Math.min(startIndex + rowsPerPage, totalRows);
            
            const maxCols = Math.max(...extractedData.map(row => row.length));
            let headers = extractedData.find(row => row.length > 1) || [];
            if (headers.length === 0 && extractedData.length > 0) headers = extractedData[0];
            
            const headerRow = document.createElement('tr');
            for (let i = 0; i < maxCols; i++) {
                const th = document.createElement('th');
                th.textContent = headers[i] || `Columna ${i + 1}`;
                headerRow.appendChild(th);
            }
            tableHeader.appendChild(headerRow);
            
            for (let i = startIndex; i < endIndex; i++) {
                const row = extractedData[i];
                const tr = document.createElement('tr');
                for (let j = 0; j < maxCols; j++) {
                    const td = document.createElement('td');
                    td.textContent = row[j] || '';
                    tr.appendChild(td);
                }
                tableBody.appendChild(tr);
            }
            
            rowCount.textContent = totalRows;
            generatePagination(totalPages);
        }
        
        function generatePagination(totalPages) {
            pagination.innerHTML = '';
            if (totalPages <= 1) return;

            const createBtn = (text, page, isDisabled = false, isCurrent = false, label = `Ir a la página ${page}`) => {
                const btn = document.createElement('button');
                btn.className = `pagination-btn ${isCurrent ? 'active' : ''}`;
                btn.innerHTML = text;
                btn.disabled = isDisabled;
                btn.setAttribute('aria-label', label);
                if (isCurrent) btn.setAttribute('aria-current', 'page');
                btn.addEventListener('click', () => {
                    currentPage = page;
                    displayPreview();
                });
                return btn;
            };

            pagination.appendChild(createBtn('<i class="fas fa-chevron-left"></i>', currentPage - 1, currentPage === 1, false, 'Página anterior'));

            for (let i = 1; i <= totalPages; i++) {
                pagination.appendChild(createBtn(i, i, false, i === currentPage));
            }

            pagination.appendChild(createBtn('<i class="fas fa-chevron-right"></i>', currentPage + 1, currentPage === totalPages, false, 'Página siguiente'));
        }
        
        function downloadFile() {
            if (extractedData.length === 0) return;
            
            const fileName = document.getElementById('exportFileName').value || `convertido_${Date.now()}`;
            const includeMetadata = document.getElementById('includeMetadata')?.checked;
            
            if (isEditMode) saveEditedData();
            
            switch (outputFormat) {
                case 'pdf': downloadPDF(fileName, includeMetadata); break;
                case 'docx': downloadWord(fileName, includeMetadata); break;
                case 'xlsx': downloadExcel(fileName, includeMetadata); break;
                case 'pptx': downloadPowerPoint(fileName, includeMetadata); break;
                case 'txt': downloadText(fileName, includeMetadata); break;
                case 'html': downloadHTML(fileName, includeMetadata); break;
            }
        }
        
        function saveEditedData() {
            const rows = tableBody.querySelectorAll('tr');
            const startIndex = (currentPage - 1) * rowsPerPage;
            rows.forEach((row, rowIndex) => {
                const dataIndex = startIndex + rowIndex;
                if (dataIndex < extractedData.length) {
                    const cells = row.querySelectorAll('td');
                    extractedData[dataIndex] = Array.from(cells).map(cell => cell.textContent);
                }
            });
        }

        function downloadPDF(fileName, includeMetadata) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const head = [Array.from(tableHeader.querySelectorAll('th')).map(th => th.textContent)];
            const body = extractedData.slice();
            doc.autoTable({ head, body });
            doc.save(fileName + '.pdf');
            showNotification('Descarga completada', `${fileName}.pdf descargado.`, 'success');
        }

        function downloadWord(fileName, includeMetadata) {
            const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType } = docx;

            const tableRows = extractedData.map(row => 
                new TableRow({
                    children: row.map(cell => 
                        new TableCell({
                            children: [new Paragraph(cell || "")],
                            width: { size: 100 / row.length, type: WidthType.PERCENTAGE },
                        })
                    ),
                })
            );

            const table = new Table({ rows: tableRows });

            const doc = new Document({ sections: [{ children: [table] }] });

            Packer.toBlob(doc).then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName + '.docx';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('Descarga completada', `${fileName}.docx descargado.`, 'success');
            });
        }

        function downloadExcel(fileName, includeMetadata) {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(extractedData);
            XLSX.utils.book_append_sheet(wb, ws, 'Datos Convertidos');
            XLSX.writeFile(wb, fileName + '.xlsx');
            showNotification('Descarga completada', `${fileName}.xlsx descargado.`, 'success');
        }

        function downloadPowerPoint(fileName, includeMetadata) {
            let pptx = new PptxGenJS();
            extractedData.forEach((row, index) => {
                let slide = pptx.addSlide();
                const tableData = [{
                    text: `Datos de la fila ${index + 1}`,
                    options: { fontSize: 18, bold: true, breakLine: true }
                }, {
                    text: row.join('\n'),
                    options: { fontSize: 14 }
                }];
                slide.addTable([tableData], { x: 0.5, y: 1.0, w: '90%', h: '75%' });
            });
            pptx.writeFile({ fileName: fileName + '.pptx' });
            showNotification('Descarga completada', `${fileName}.pptx descargado.`, 'success');
        }

        function downloadText(fileName, includeMetadata) {
            let textContent = extractedData.map(row => row.join('\t')).join('\n');
            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName + '.txt';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Descarga completada', `${fileName}.txt descargado.`, 'success');
        }

        function downloadHTML(fileName, includeMetadata) {
            let htmlContent = `<!DOCTYPE html><html><head><title>${fileName}</title><style>table,th,td{border:1px solid black;border-collapse:collapse;padding:5px;}</style></head><body><table>`;
            const headers = Array.from(tableHeader.querySelectorAll('th')).map(th => th.textContent);
            htmlContent += `<thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead><tbody>`;
            htmlContent += extractedData.map(row => `<tr>${row.map(cell => `<td>${cell || ''}</td>`).join('')}</tr>`).join('');
            htmlContent += '</tbody></table></body></html>';
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName + '.html';
            link.click();
            showNotification('Descarga completada', `${fileName}.html descargado.`, 'success');
        }
        
        function selectLanguage() {
            const languages = [
                { code: 'spa', name: 'Español' }, { code: 'eng', name: 'Inglés' }, { code: 'fra', name: 'Francés' },
                { code: 'deu', name: 'Alemán' }, { code: 'ita', name: 'Italiano' }, { code: 'por', name: 'Portugués' }
            ];
            const currentIndex = languages.findIndex(lang => lang.code === ocrLanguage);
            const nextIndex = (currentIndex + 1) % languages.length;
            ocrLanguage = languages[nextIndex].code;
            languageSelect.querySelector('span').textContent = languages[nextIndex].name;
        }

        function getLanguageName(code) {
             const languages = [
                { code: 'spa', name: 'Español' }, { code: 'eng', name: 'Inglés' }, { code: 'fra', name: 'Francés' },
                { code: 'deu', name: 'Alemán' }, { code: 'ita', name: 'Italiano' }, { code: 'por', name: 'Portugués' }
            ];
            const lang = languages.find(l => l.code === code);
            return lang ? lang.name : 'Desconocido';
        }
        
        function showError(message) {
            uploadSection.classList.add('hidden');
            progressSection.classList.add('hidden');
            previewSection.classList.add('hidden');
            errorSection.classList.remove('hidden');
            errorMessage.textContent = message;
            if (settings.enableNotifications) showNotification('Error', message, 'error');
        }
        
        function resetConverter() {
            uploadSection.classList.remove('hidden');
            progressSection.classList.add('hidden');
            previewSection.classList.add('hidden');
            errorSection.classList.add('hidden');
            fileInput.value = '';
            extractedData = [];
            isProcessing = false;
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('[role="tabpanel"]').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            document.querySelectorAll('[role="tab"]').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
                btn.setAttribute('tabindex', '-1');
            });
            const selectedBtn = document.getElementById(`${tabName}-tab-btn`);
            selectedBtn.classList.add('active');
            selectedBtn.setAttribute('aria-selected', 'true');
            selectedBtn.setAttribute('tabindex', '0');
            selectedBtn.focus();
        }
        
        function showNotification(title, message, type = 'info') {
            const typeMap = {
                success: { icon: 'fa-check-circle', color: 'success' },
                error: { icon: 'fa-exclamation-circle', color: 'error' },
                warning: { icon: 'fa-exclamation-triangle', color: 'warning' },
                info: { icon: 'fa-info-circle', color: 'info' }
            };
            const config = typeMap[type];
            notificationIcon.className = `notification-icon ${config.color}`;
            notificationIcon.innerHTML = `<i class="fas ${config.icon}" aria-hidden="true"></i>`;
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notificationToast.classList.add('show');
            setTimeout(() => notificationToast.classList.remove('show'), 5000);
        }
        
        function saveToHistory(fileNames, format) {
            const historyItem = {
                id: Date.now(), date: new Date().toISOString(), inputFormat, outputFormat: format, fileNames, rows: extractedData.length
            };
            conversionHistory.unshift(historyItem);
            if (conversionHistory.length > 20) conversionHistory.pop();
            localStorage.setItem('conversionHistory', JSON.stringify(conversionHistory));
            renderHistory();
        }
        
        function renderHistory() {
            if (conversionHistory.length === 0) {
                historyList.innerHTML = `<div class="text-center py-12 text-gray-500"><i class="fas fa-inbox text-5xl mb-4"></i><p>No hay conversiones recientes</p></div>`;
                return;
            }
            historyList.innerHTML = '';
            conversionHistory.forEach(item => {
                const date = new Date(item.date).toLocaleString();
                const historyItem = document.createElement('article');
                historyItem.className = 'history-item bg-white p-4 border rounded-lg flex justify-between items-center';
                historyItem.innerHTML = `
                    <div>
                        <h4 class="font-medium">${item.fileNames.join(', ')}</h4>
                        <div class="flex items-center text-sm text-gray-500 mt-1">
                            <span class="mr-3"><i class="fas fa-calendar mr-1"></i> ${date}</span>
                            <span class="mr-3"><i class="fas fa-exchange-alt mr-1"></i> ${item.inputFormat.toUpperCase()} → ${item.outputFormat.toUpperCase()}</span>
                            <span><i class="fas fa-table mr-1"></i> ${item.rows} filas</span>
                        </div>
                    </div>
                    <div>
                        <button class="history-delete p-2 text-red-500 hover:bg-red-50 rounded-full" data-id="${item.id}" aria-label="Eliminar del historial">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>`;
                historyList.appendChild(historyItem);
            });
            document.querySelectorAll('.history-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.getAttribute('data-id'));
                    conversionHistory = conversionHistory.filter(h => h.id !== id);
                    localStorage.setItem('conversionHistory', JSON.stringify(conversionHistory));
                    renderHistory();
                });
            });
        }
    </script>
</body>
</html>
